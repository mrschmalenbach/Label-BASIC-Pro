REM good_all_features_mixed_structures.lbp
REM A broad, mixed-feature regression test

REM ##OPTION STRICT_ERR ON
REM ##OPTION DEFINE ON
REM ##OPTION REMPASS ON

REM -----------------------------------------
REM CONSTANTS & ENUMS
REM -----------------------------------------

CONSTANT
MAX_LEVEL% = 3
MAX_SCORE% = 100
NAME_PROMPT$ = "ENTER PLAYER NAME: "
ENDCONST

ENUM LEVEL_STATES
LEVEL_LOCKED
LEVEL_ACTIVE
LEVEL_COMPLETE
END ENUM

REM -----------------------------------------
REM INITIAL DATA
REM -----------------------------------------

DIM LEVEL.STATE%(MAX_LEVEL%)
DIM LEVEL.SCORE%(MAX_LEVEL%)

I% = 1
WHILE I%<=MAX_LEVEL%
  LEVEL.STATE%(I%) = LEVEL_LOCKED
  LEVEL.SCORE%(I%) = 0
  I% = I% + 1
WEND

LEVEL.STATE%(1) = LEVEL_ACTIVE

REM -----------------------------------------
REM MAIN FLOW
REM -----------------------------------------

PRINT "MIXED STRUCTURE TEST START..."

PLAYER.NAME$ = "TESTER"

PRINT "PLAYER=";PLAYER.NAME$
PRINT "MAX_LEVEL=";MAX_LEVEL%;" MAX_SCORE=";MAX_SCORE%

CURRENT.LEVEL% = 1

REM Loop over levels with WHILE
WHILE CURRENT.LEVEL%<=MAX_LEVEL%

  PRINT
  PRINT "ENTERING LEVEL";CURRENT.LEVEL%

  IF LEVEL.STATE%(CURRENT.LEVEL%)=LEVEL_LOCKED THEN
    PRINT "  LEVEL IS LOCKED - EXIT LOOP"
    EXIT WHILE
  END IF

  REM Inner REPEAT/UNTIL to simulate attempts
  ATTEMPT% = 0

  REPEAT
    ATTEMPT% = ATTEMPT% + 1

    IF ATTEMPT%=1 THEN
      PRINT "  FIRST ATTEMPT AT LEVEL";CURRENT.LEVEL%
    ELSE
      PRINT "  ATTEMPT";ATTEMPT%;" AT LEVEL";CURRENT.LEVEL%
    END IF

    SCORE.GAIN% = 10 * CURRENT.LEVEL%
    LEVEL.SCORE%(CURRENT.LEVEL%) = LEVEL.SCORE%(CURRENT.LEVEL%) + SCORE.GAIN%

    PRINT "  SCORE NOW=";LEVEL.SCORE%(CURRENT.LEVEL%)

    IF LEVEL.SCORE%(CURRENT.LEVEL%)>=MAX_SCORE% THEN
      PRINT "  LEVEL COMPLETE!"
      LEVEL.STATE%(CURRENT.LEVEL%) = LEVEL_COMPLETE
      EXIT REPEAT
    END IF

    IF ATTEMPT%>5 THEN
      PRINT "  TOO MANY ATTEMPTS - CONTINUE REPEAT FOR FINAL CHECK"
      CONTINUE REPEAT
    END IF

  UNTIL LEVEL.SCORE%(CURRENT.LEVEL%)>=MAX_SCORE%

  IF LEVEL.STATE%(CURRENT.LEVEL%)=LEVEL_COMPLETE THEN
    PRINT "LEVEL";CURRENT.LEVEL%;" MARKED COMPLETE."
  ELSE
    PRINT "LEVEL";CURRENT.LEVEL%;" NOT COMPLETE."
  END IF

  CURRENT.LEVEL% = CURRENT.LEVEL% + 1

  IF CURRENT.LEVEL%<=MAX_LEVEL% THEN
    PRINT "UNLOCKING NEXT LEVEL";CURRENT.LEVEL%
    LEVEL.STATE%(CURRENT.LEVEL%) = LEVEL_ACTIVE
  END IF

WEND

PRINT
PRINT "FINAL LEVEL STATES AND SCORES:"

I% = 1
WHILE I%<=MAX_LEVEL%
  PRINT "  LEVEL";I%;" STATE=";LEVEL.STATE%(I%);" SCORE=";LEVEL.SCORE%(I%)
  I% = I% + 1
WEND

PRINT
PRINT "MIXED STRUCTURE TEST COMPLETE."
